@model TrashCollector.Models.Customer

@{
    ViewBag.Title = "Details";
}

<h2>Details</h2>

<div>
    <h4>Customer</h4>
    <hr />
    <dl class="dl-horizontal">
        <dt>
            @Html.DisplayNameFor(model => model.City.Name)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.City.Name)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.State.Abbreviation)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.State.Abbreviation)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Zipcode.Zip)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Zipcode.Zip)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.FirstName)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.FirstName)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.LastName)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.LastName)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.EmailAddress)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.EmailAddress)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.StreetAddress1)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.StreetAddress1)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.StreetAddress2)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.StreetAddress2)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.PickupDay)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.PickupDay.Name)
        </dd>

    </dl>
</div>

<input id="userAddress" hidden value="@Model.StreetAddress1@Model.City.Name@Model.State.Abbreviation" />

@if (User.IsInRole("Employee"))
{
    <style>
        #map {
            height: 400px;
            width: 400px;
        }
    </style>

    <div id="map"></div>
    <script>
        function findAddress() {
            var xmlhttp = new XMLHttpRequest();
            xmlhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    var json = JSON.parse(this.response);
                    
                    var glat = json.results[0].geometry.location.lat;
                    var glng = json.results[0].geometry.location.lng;

                    var map = new google.maps.Map(document.getElementById('map'), {
                        center: { lat: 43.038902, lng: -87.906474 },
                        zoom: 12
                    });
                    var marker = new google.maps.Marker({
                        position: { lat: glat, lng: glng },
                        map: map
                    })
                }
            };

            var location = document.getElementById('userAddress').value.replace(' ', '');
            console.log(location);
            xmlhttp.open("GET", "http://maps.googleapis.com/maps/api/geocode/json?address={" + location + "}&sensor=false", true);
            xmlhttp.send();
        };
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBxX_PLyVL008eoD7yGSgYvqzNPkAWNy_k&callback=findAddress"
            async defer></script>
}
    <p>
        @if (!User.IsInRole("Employee"))
        {
            @Html.ActionLink("Edit", "Edit", new { id = Model.CustomerId }) 
        }
        @Html.ActionLink("Back to List", "Index")
    </p>
